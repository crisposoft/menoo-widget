<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Menoo Widget - Quick Start Example</title>
    <style>
      body {
        margin: 0;
        padding: 20px;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        background: #f5f5f5;
      }

      .header {
        max-width: 1280px;
        margin: 0 auto 20px;
        padding: 20px;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      h1 {
        margin: 0 0 10px;
        color: #212121;
      }

      p {
        margin: 0;
        color: #757575;
      }

      .controls {
        max-width: 1280px;
        margin: 0 auto 20px;
        padding: 20px;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      button {
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        background: #f0ac28;
        color: white;
        font-weight: 500;
        cursor: pointer;
        transition: background 0.2s;
      }

      button:hover {
        background: #996d1a;
      }

      select {
        padding: 10px;
        border: 1px solid #e0e0e0;
        border-radius: 4px;
        font-size: 14px;
      }

      #menoo-widget-container {
        max-width: 1280px;
        margin: 0 auto;
      }

      .event-log {
        max-width: 1280px;
        margin: 20px auto;
        padding: 20px;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .event-log h3 {
        margin: 0 0 10px;
      }

      .event-log pre {
        background: #f5f5f5;
        padding: 10px;
        border-radius: 4px;
        overflow-x: auto;
        font-size: 12px;
        max-height: 200px;
        overflow-y: auto;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h1>Menoo Widget - Quick Start Example</h1>
      <p>
        This example demonstrates the Menoo Widget SDK with full ordering
        capabilities
      </p>
    </div>

    <div class="controls">
      <input
        type="text"
        id="restaurant-id"
        placeholder="Enter Restaurant ID"
        value="demo"
        style="
          padding: 10px;
          border: 1px solid #e0e0e0;
          border-radius: 4px;
          font-size: 14px;
          min-width: 250px;
        "
      />
      <button id="btn-load-widget">Load Widget</button>
      <button id="btn-clear-cart">Clear Cart</button>
      <button id="btn-get-cart">Get Cart Info</button>
      <select id="language-select">
        <option value="ro">Română</option>
        <option value="en">English</option>
        <option value="ru">Русский</option>
      </select>
    </div>

    <!-- Widget Container -->
    <div id="menoo-widget-container"></div>

    <!-- Event Log -->
    <div class="event-log">
      <h3>Event Log</h3>
      <pre id="event-log">Waiting for widget to initialize...</pre>
    </div>

    <!-- Load the Menoo Widget SDK -->
    <script type="module">
      import MenooSDK from "https://widget.menoo.ro/v1/menoo-sdk.js";

      let isInitialized = false;

      // Initialize the widget
      async function initWidget() {
        const restaurantId = document.getElementById("restaurant-id").value;
        const language = document.getElementById("language-select").value;

        if (!restaurantId) {
          alert("Please enter a Restaurant ID");
          return;
        }

        // Destroy existing widget if already initialized
        if (isInitialized) {
          MenooSDK.destroy();
          isInitialized = false;
        }

        try {
          await MenooSDK.init({
            restaurantId: restaurantId,
            container: "#menoo-widget-container",
            language: language,
            stickyOffset: 0, // Top offset for sticky elements (set to your header height if you have one)
          });

          logEvent("Widget initialized successfully", { restaurantId, language });
          isInitialized = true;
        } catch (error) {
          logEvent("Initialization error", error);
          console.error("Failed to initialize widget:", error);
          alert("Failed to load widget. Please check the Restaurant ID and try again.");
        }
      }

      // Event listeners
      function setupEventListeners() {
        // Widget events
        window.addEventListener("menoo:ready", (e) => {
          logEvent("Widget ready", e.detail);
        });

        window.addEventListener("menoo:cart-changed", (e) => {
          logEvent("Cart changed", e.detail);
        });

        window.addEventListener("menoo:item-added", (e) => {
          logEvent("Item added", e.detail);
        });

        window.addEventListener("menoo:checkout-started", (e) => {
          logEvent("Checkout started", e.detail);
        });

        window.addEventListener("menoo:error", (e) => {
          logEvent("Error", e.detail);
        });

        // Control buttons
        document
          .getElementById("btn-load-widget")
          .addEventListener("click", () => {
            initWidget();
          });

        document
          .getElementById("btn-clear-cart")
          .addEventListener("click", () => {
            if (!isInitialized) {
              alert("Please load the widget first");
              return;
            }
            MenooSDK.clearCart();
            logEvent("Cart cleared manually");
          });

        document
          .getElementById("btn-get-cart")
          .addEventListener("click", () => {
            if (!isInitialized) {
              alert("Please load the widget first");
              return;
            }
            // Get cart in API format (ready to send to backend)
            const apiCart = MenooSDK.getCartForApi();
            const info = {
              itemCount: MenooSDK.getItemCount(),
              total: MenooSDK.getTotalPrice(),
              cart: apiCart,
            };
            logEvent("Current cart info (API format)", info);
            alert(JSON.stringify(info, null, 2));
          });

        document
          .getElementById("language-select")
          .addEventListener("change", async (e) => {
            if (!isInitialized) return;
            const lang = e.target.value;
            // Reload widget with new language
            await initWidget();
            logEvent(`Language changed to ${lang}`);
          });
      }

      // Event logger
      const eventLog = [];
      function logEvent(message, data) {
        const timestamp = new Date().toLocaleTimeString();
        const entry = { timestamp, message, data };
        eventLog.unshift(entry);

        // Keep only last 20 events
        if (eventLog.length > 20) {
          eventLog.pop();
        }

        document.getElementById("event-log").textContent = eventLog
          .map(
            (e) =>
              `[${e.timestamp}] ${e.message}${
                e.data ? ": " + JSON.stringify(e.data) : ""
              }`
          )
          .join("\n");
      }

      // Initialize
      setupEventListeners();
      logEvent("Ready to load widget. Enter a Restaurant ID and click 'Load Widget'");
    </script>
  </body>
</html>
